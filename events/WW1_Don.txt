add_namespace = ww1_don

#kaledin does kys
country_event = {
	title = ww1_don.1.t
	desc = ww1_don.1.d
	id = ww1_don.1
	picture = GFX_report_event_royal_parade
	fire_only_once = yes
	is_triggered_only = yes
	trigger = {
		has_country_leader = {
			character = RUS_alexei_kaledin
		}	
		NOT = {
			controls_province = 3147
		}
	}	
	option = {
		name = ww1_don.1.a		
		retire_character = RUS_alexei_kaledin
		DON_pyotr_popov = {
			promote_leader = yes
		}
		DON_anatoliy_nazarov = {
			promote_character = oligarchism
			promote_character = stratocracy
		}
        hidden_effect = {
			SOV = {
				country_event = {
					id = ww1_don.6
					days = 3
				}
			}
        }
	}
}
#Krasnov rises up
country_event = {
	id = ww1_don.2
	title = ww1_don.2.t
	desc = ww1_don.2.d
	picture = GFX_report_event_royal_parade
	fire_only_once = yes
	trigger = {
		tag = DON
		has_government = communism
		is_subject_of = SOV
		has_country_flag = communist_takeover
		any_neighbor_country = {
			OR = {
				original_tag = GER
				is_subject_of = GER
				is_in_faction_with = GER
			}
		}	
	}
	immediate = {
		hidden_effect = {
            country_event = {
                id = ww1_don.3
                days = 14
            }
			clr_country_flag = DON_soviet_tag
			start_civil_war = {
				ruling_party = fascism
				ideology = communism
				set_country_flag = DON_soviet_tag
				size = 0.8
				capital = 245
				states = {
					238
					245
					265
				}
			}
			DON = {				
				country_lock_all_division_template = no
				if = {
					limit = {
						has_character = RUS_pyotr_krasnov
					}
					RUS_pyotr_krasnov = {
						promote_leader = yes
						promote_character = stratocracy
						promote_character = despotism
					}
				}
				add_ideas = {
					RUS_cossack_volnitsa
					RUS_russian_civil_war
				}	
				remove_ideas = {
					standing_alone
				}	
				declare_war_on = {
					target = SOV
					type = civil_war
				}
				set_politics = {
					ruling_party = fascism
					elections_allowed = no 
				}
				set_popularities = {
					fascism = 64
					communism = 2
					democratic = 2
					neutrality = 32
				}
			}
			218 = {
				create_unit = {
					division = "division_template = \"Kazatskaya Brigada\" start_experience_factor = 0.4 start_equipment_factor = 1"
					owner = DON
					allow_spawning_on_enemy_provs = yes
					prioritize_location = 9446
					count = 2
				}
				create_unit = {
					division = "division_template = \"Kazatskaya Brigada\" start_experience_factor = 0.4 start_equipment_factor = 1"
					owner = DON
					allow_spawning_on_enemy_provs = yes
					prioritize_location = 6493
					count = 2
				}
				create_unit = {
					division = "division_template = \"Pekhotnaya Diviziya\" start_experience_factor = 0.4 start_equipment_factor = 1"
					owner = DON
					allow_spawning_on_enemy_provs = yes
					prioritize_location = 1043
					count = 1
				}
			}
        }
	}
	option = {
		name = ww1_don.2.a		      
	}
	option = {
		name = ww1_don.2.b
		random_other_country = {
			limit = {
				original_tag = DON
				has_government = communism
			}
			change_tag_from = ROOT
		}	
        trigger = {
			is_ai = no
	    }
	}
}
#Don receives weapons from Germany
country_event = {
	title = ww1_don.3.t
	desc = ww1_don.3.d
	id = ww1_don.3
	picture = GFX_report_event_royal_parade
	fire_only_once = yes
    is_triggered_only = yes
	trigger = {
        GER = {
            NOT = {
                has_war_with = RUS
            }
        }
	}
	option = {
		name = ww1_don.3.a		
		add_equipment_to_stockpile = {
			type = infantry_equipment
			amount = 2500
			producer = GER
		}
	}
}
#Soviet Invasion - SOV
country_event = {
	title = ww1_don.4.t
	desc = ww1_don.4.d
	id = ww1_don.4
	picture = GFX_report_event_royal_parade
	fire_only_once = yes
    is_triggered_only = yes
	option = {
		name = ww1_don.4.a
		effect_tooltip = {
			start_civil_war = {
				ideology = communism
			}
		}	
		hidden_effect = {
			DON = {
				country_event = {
					id = ww1_don.5
					days = 2
				}
				create_dynamic_country = {
					original_tag = DON
					copy_tag = DON
					add_political_power = 100
					transfer_state = 218
					set_politics = {
						ruling_party = communism
					}
					add_popularity = {
						ideology = communism
						popularity = 1
					}
					declare_war_on = {
						target = DON
						type = civil_war
					}
					set_country_flag = DON_sr
					add_ideas = SOV_idea_red_guard
					division_template = {
						name = "Krasnaya Gvardiya"
						regiments = {
							militia = { x = 0 y = 0 }
							militia = { x = 0 y = 1 }
							militia = { x = 1 y = 0 }
						}
					}
					every_state = {
						limit = {
							is_core_of = DON
						}
						add_core_of = DSR
					}
					SOV = {
						add_to_faction = DSR
					}
					every_possible_country = {
						limit = {
							has_character = DON_fyodor_podtyolkov
						}
						DON_fyodor_podtyolkov = {
							set_nationality = DSR
							promote_leader = yes
						}
					}
					every_possible_country = {
						limit = {
							has_character = DON_victor_kovalyov
						}
						DON_victor_kovalyov = {
							set_nationality = DSR
						}
					}
					every_possible_country = {
						limit = {
							has_character = DON_nikolai_golubov
						}
						DON_nikolai_golubov = {
							set_nationality = DSR
						}
					}
					promote_character = {
						character = DON_fyodor_podtyolkov
						ideology = marxism
					}
					declare_war_on = {
						target = DON
						type = civil_war
					}
				}
				SOV = {
					declare_war_on = {
						target = DON
						type = annex_everything
					}
				}
				# could be useful later for reverting
				# start_civil_war = {
				# 	ideology = communism
				# 	size = 0
				# 	capital = 218
				# 	states = {
				# 		218
				# 	}
				# 	add_ideas = standing_alone	
				# 	set_country_flag = DON_sr
				# 	division_template = {
				# 		name = "Krasnaya Gvardiya"
				# 		division_names_group = SOV_INF_01
				# 		regiments = {
				# 			militia = { x = 0 y = 0 }
				# 			militia = { x = 0 y = 1 }
				# 			militia = { x = 1 y = 0 }
				# 			militia = { x = 1 y = 1 }
				# 		}
				# 	}
				# 	keep_unit_leaders_trigger = {
				# 		NOT = {
				# 			is_character = DON_fyodor_podtyolkov
				# 			is_character = DON_victor_kovalyov
				# 			is_character = DON_nikolai_golubov
				# 		}	
				# 	}	
				# 	SOV = {
				# 		add_to_faction = DSR
				# 	}						
				# }
			}	
			218 = {
				create_unit = {
					division = "division_template = \"Krasnaya Gvardiya\" start_experience_factor = 0.2" 
					owner = DSR
					allow_spawning_on_enemy_provs = yes
					count = 3
				}
			}
		}
	}
}
#Soviet Invasion - DON
country_event = {
	title = ww1_don.5.t
	desc = ww1_don.5.d
	id = ww1_don.5
	picture = GFX_report_event_royal_parade
	fire_only_once = yes
    is_triggered_only = yes
	option = {
		name = ww1_don.5.a		
		add_ideas = RUS_russian_civil_war
	}
}
#DON sr takes states for survival, hidden
country_event = {
	title = ww1_don.6.t
	desc = ww1_don.6.d
	id = ww1_don.6
	picture = GFX_report_event_royal_parade
	fire_only_once = yes
	is_triggered_only = yes
	hidden = yes
	immediate = {
		hidden_effect = {
			265 = {
				transfer_state_to = DSR
			}
			245 = {
				transfer_state_to = DSR
			}
		}
	}
	option = {
		name = ww1_don.6.a	
	}
}

#Volunteer army question
country_event = {
	title = ww1_don.7.t
	desc = ww1_don.7.d
	id = ww1_don.7
	picture = GFX_report_event_royal_parade
	fire_only_once = yes
	is_triggered_only = yes
	option = {
		name = ww1_don.7.a
		swap_ideas = {
			remove_idea = DON_alekseev_organization_5
			add_idea = DON_volunteer_army_idea
		}	
		ai_chance = {
			factor = 100
		}	
	}
}

#First Batallions formed
country_event = {
	title = ww1_don.8.t
	desc = ww1_don.8.d
	id = ww1_don.8
	picture = GFX_report_event_royal_parade
	fire_only_once = yes
	is_triggered_only = yes
	option = {
		name = ww1_don.8.a
		245 = {
			create_unit = {
				division = "name = \"Oficerskiy batal'yon\" division_template = \"Volunteer Regiment\" start_experience_factor = 1 start_equipment_factor = 1"
				owner = DON
				allow_spawning_on_enemy_provs = yes
				prioritize_location = 3147
				count = 1
			}
			create_unit = {
				division = "name = \"Yunkerskiy batal'yon\" division_template = \"Volunteer Regiment\" start_experience_factor = 1 start_equipment_factor = 1"
				owner = DON
				allow_spawning_on_enemy_provs = yes
				prioritize_location = 3147
				count = 1
			}
		}
		every_possible_country = {
			limit = {
				has_character = RUS_aleksandr_kutepov
			}
			RUS_aleksandr_kutepov = {
				set_nationality = DON
			}		
		}
		every_possible_country = {
			limit = {
				has_character = RUS_sergey_markov
			}
			RUS_sergey_markov = {
				set_nationality = DON			
			}		
		}	
		ai_chance = {
			factor = 100
		}	
	}
}

# Other Batallions formed
country_event = {
	title = ww1_don.9.t
	desc = ww1_don.9.d
	id = ww1_don.9
	picture = GFX_report_event_royal_parade
	fire_only_once = yes
	is_triggered_only = yes
	option = {
		name = ww1_don.9.a
		245 = {
			create_unit = {
				division = "name = \"Oficerskiy kavaleristskiy polk\" division_template = \"Volunteer Cavalry Regiment\" start_experience_factor = 1 start_equipment_factor = 0.2"
				owner = DON
				allow_spawning_on_enemy_provs = yes
				prioritize_location = 3147
				count = 1
			}
			create_unit = {
				division = "name = \"Studencheskiy batal'yon\" division_template = \"Volunteer Regiment\" start_experience_factor = 0.1 start_equipment_factor = 0.3"
				owner = DON
				allow_spawning_on_enemy_provs = yes
				prioritize_location = 3147
				count = 1
			}
			create_unit = {
				division = "name = \"Georgievskiy polk\" division_template = \"Volunteer Regiment\" start_experience_factor = 1 start_equipment_factor = 1"
				owner = DON
				allow_spawning_on_enemy_provs = yes
				prioritize_location = 3147
				count = 1
			}
		}	
		ai_chance = {
			factor = 100
		}	
	}
}

#Ex Kornilov regiment troops arrive
country_event = {
	title = ww1_don.10.t
	desc = ww1_don.10.d
	id = ww1_don.10
	picture = GFX_report_event_royal_parade
	fire_only_once = yes
	trigger = {
		tag = DON
		has_completed_focus = DON_Alekseev_organization
		NOT = {
			country_exists = SRA
			has_global_flag = RUS_SRA_spawned
			has_government = communism
		}
	}
	mean_time_to_happen = {
		days = 15
	}
	option = {
		name = ww1_don.10.a
		ai_chance = {
			factor = 100
		}
		custom_effect_tooltip = DON_kornilov_battalion_can_be_formed
		set_country_flag = kornilovites_arrived	
		every_possible_country = {
			limit = {
				has_character = RUS_lavr_kornilov
			}
			RUS_lavr_kornilov = {
				set_nationality = DON
			}	
		}
	}
}

#Alekseev arrives with train
country_event = {
	title = ww1_don.11.t
	desc = ww1_don.11.d
	id = ww1_don.11
	picture = GFX_report_event_royal_parade
	fire_only_once = yes
	trigger = {
		tag = DON
		country_exists = SOV
		NOT = {
			country_exists = SRA
			has_global_flag = RUS_SRA_spawned
			has_government = communism
		}
	}
	mean_time_to_happen = {
		days = 10
	}
	option = {
		name = ww1_don.11.a
		ai_chance = {
			factor = 100
		}
		every_possible_country = {
			limit = {
				has_character = RUS_mikhail_alekseyev
			}
			RUS_mikhail_alekseyev = {
				set_nationality = DON
			}	
		}
		set_country_flag = alekseev_arrived	
		activate_mission = SRA_vol_departure
		mark_focus_tree_layout_dirty = yes
	}
}